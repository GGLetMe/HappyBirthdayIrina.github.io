<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–° –î–Ω—ë–º –†–æ–∂–¥–µ–Ω–∏—è!</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Pacifico&display=swap');
    
    body {
      margin: 0;
      padding: 0;
      font-family: 'Arial Rounded MT Bold', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #ff6ec4, #7873f5);
      overflow: hidden;
      text-align: center;
      color: #fff;
      position: relative;
    }
    
    h1 {
      font-family: 'Pacifico', cursive;
      font-size: 2.5em;
      margin-bottom: 20px;
      text-shadow: 2px 4px 8px rgba(0,0,0,0.3);
      animation: fadeInDown 1s ease;
    }
    
    .cake-container {
      position: relative;
      width: 180px;
      height: 130px;
      margin: 1em auto;
      cursor: pointer;
      animation: fadeInUp 1s ease;
    }
    
    .cake {
      position: absolute;
      bottom: 0;
      width: 160px;
      height: 70px;
      background: #f9c5d1;
      border-radius: 10px 10px 40px 40px;
      box-shadow: inset -12px 0 #f3a6b7;
    }
    
    .cake:before {
      content: '';
      position: absolute;
      top: -8px;
      left: 0;
      width: 160px;
      height: 25px;
      background: #ffdfe8;
      border-radius: 8px 8px 0 0;
    }
    
    .candle {
      position: absolute;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      width: 10px;
      height: 35px;
      background: linear-gradient(to right, #ffd700, #ffec80, #ffd700);
      border-radius: 3px;
      z-index: 2;
    }
    
    .flame {
      position: absolute;
      top: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 12px;
      height: 25px;
      background: linear-gradient(to top, #ff7800, #ffec80);
      border-radius: 50% 50% 20% 20%;
      box-shadow: 0 0 10px #ff7800, 0 0 20px #ffec80;
      animation: flicker 0.8s infinite alternate;
      z-index: 3;
    }
    
    .smoke {
      position: absolute;
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
      width: 4px;
      height: 15px;
      background: #ccc;
      border-radius: 50%;
      opacity: 0;
      z-index: 1;
    }
    
    .instruction {
      margin: 1em 0;
      font-size: 0.9em;
      color: #fff;
      font-weight: 300;
      animation: pulse 2s infinite;
      max-width: 90%;
    }
    
    .message {
      display: none;
      font-size: 1.3em;
      margin: 20px 0;
      animation: fadeIn 2s forwards;
      text-shadow: 0 0 8px rgba(0,0,0,0.3);
    }
    
    .action-button {
      margin: 10px 0;
      padding: 8px 16px;
      background: rgba(255,255,255,0.2);
      border: 2px solid white;
      border-radius: 25px;
      color: white;
      font-size: 0.9em;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .action-button:hover {
      background: rgba(255,255,255,0.3);
    }
    
    .action-button:active {
      transform: scale(0.95);
    }
    
    .warning {
      font-size: 0.8em;
      color: rgba(255,255,255,0.7);
      margin-top: 5px;
    }
    
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes flicker {
      0%, 100% { transform: translateX(-50%) scale(1); }
      50% { transform: translateX(-50%) scale(0.9, 1.1); }
    }
    
    @keyframes smoke {
      0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
      100% { transform: translateX(-50%) translateY(-40px) scale(2.5); opacity: 0; }
    }
    
    @keyframes pulse {
      0% { opacity: 0.6; }
      50% { opacity: 1; }
      100% { opacity: 0.6; }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }
  </style>
</head>
<body>
  <h1>–° –î–Ω—ë–º –†–æ–∂–¥–µ–Ω–∏—è! üéâ</h1>
  
  <div class="cake-container" id="cake">
    <div class="cake"></div>
    <div class="candle">
      <div class="flame" id="flame"></div>
      <div class="smoke" id="smoke"></div>
    </div>
  </div>
  
  <p class="instruction" id="instruction">–ù–∞–∂–º–∏ –Ω–∞ —Ç–æ—Ä—Ç, —á—Ç–æ–±—ã –∑–∞–¥—É—Ç—å —Å–≤–µ—á—É!</p>
  <button class="action-button" id="micButton">–ó–∞–¥—É—Ç—å —á–µ—Ä–µ–∑ –º–∏–∫—Ä–æ—Ñ–æ–Ω üé§</button>
  <button class="action-button" id="blowButton" style="display:none;">–ó–∞–¥—É—Ç—å –±–µ–∑ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞</button>
  <p class="warning" id="micWarning" style="display:none;">* –ù–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –º–∏–∫—Ä–æ—Ñ–æ–Ω –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ HTTPS</p>
  <div class="message" id="message">‚ú® –ü—É—Å—Ç—å —Å–±—É–¥—É—Ç—Å—è –≤—Å–µ –º–µ—á—Ç—ã! ‚ú®</div>

  <canvas id="confetti"></canvas>

  <script>
    // –≠–ª–µ–º–µ–Ω—Ç—ã
    const elements = {
      cake: document.getElementById('cake'),
      flame: document.getElementById('flame'),
      smoke: document.getElementById('smoke'),
      message: document.getElementById('message'),
      instruction: document.getElementById('instruction'),
      micButton: document.getElementById('micButton'),
      blowButton: document.getElementById('blowButton'),
      micWarning: document.getElementById('micWarning')
    };

    let state = {
      isCandleLit: true,
      microphoneAvailable: false,
      audioContext: null,
      analyser: null,
      dataArray: null,
      animationId: null
    };

    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–¥—É–≤–∞–Ω–∏—è —Å–≤–µ—á–∏
    function blowOutCandle() {
      if (!state.isCandleLit) return;
      
      state.isCandleLit = false;
      elements.flame.style.opacity = '0';
      elements.smoke.style.animation = 'smoke 1.5s ease-out forwards';
      elements.message.style.display = 'block';
      launchConfetti();
      elements.instruction.textContent = '–£—Ä–∞! –¢–µ–ø–µ—Ä—å –∑–∞–≥–∞–¥–∞–π –∂–µ–ª–∞–Ω–∏–µ! ‚ú®';
      elements.micButton.style.display = 'none';
      elements.blowButton.style.display = 'none';
      elements.micWarning.style.display = 'none';
      
      // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∞–ª–∏–∑ –∑–≤—É–∫–∞, –µ—Å–ª–∏ –±—ã–ª –∑–∞–ø—É—â–µ–Ω
      if (state.animationId) {
        cancelAnimationFrame(state.animationId);
      }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ —Ç–æ—Ä—Ç—É
    elements.cake.addEventListener('click', () => {
      if (state.isCandleLit && !state.microphoneAvailable) {
        elements.blowButton.style.display = 'block';
      }
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ó–∞–¥—É—Ç—å –±–µ–∑ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞"
    elements.blowButton.addEventListener('click', blowOutCandle);

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
    elements.micButton.addEventListener('click', async () => {
      try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É API
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
          throw new Error('Microphone API not supported');
        }
        
        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        state.microphoneAvailable = true;
        elements.micButton.textContent = '–î—É–π—Ç–µ –≤ –º–∏–∫—Ä–æ—Ñ–æ–Ω...';
        elements.micButton.style.background = 'rgba(0,255,0,0.2)';
        elements.instruction.textContent = '–î—É–π—Ç–µ –≤ –º–∏–∫—Ä–æ—Ñ–æ–Ω, —á—Ç–æ–±—ã –∑–∞–¥—É—Ç—å —Å–≤–µ—á—É!';
        elements.blowButton.style.display = 'none';
        elements.micWarning.style.display = 'block';
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∞–Ω–∞–ª–∏–∑ –∑–≤—É–∫–∞
        state.audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const source = state.audioContext.createMediaStreamSource(stream);
        state.analyser = state.audioContext.createAnalyser();
        state.dataArray = new Uint8Array(state.analyser.frequencyBinCount);
        source.connect(state.analyser);
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        checkVolume();
      } catch (error) {
        console.error('Microphone error:', error);
        elements.micButton.textContent = '–ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
        elements.micButton.style.background = 'rgba(255,0,0,0.2)';
        elements.blowButton.style.display = 'block';
        elements.micWarning.style.display = 'block';
        elements.instruction.textContent = '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Ç–æ—Ä—Ç';
      }
    });

    function checkVolume() {
      state.analyser.getByteFrequencyData(state.dataArray);
      let volume = state.dataArray.reduce((a,b) => a+b) / state.dataArray.length;
      
      if (volume > 60 && state.isCandleLit) {
        blowOutCandle();
      }
      
      if (state.isCandleLit) {
        state.animationId = requestAnimationFrame(checkVolume);
      }
    }

    // –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è HTTP)
    function launchConfetti() {
      const canvas = document.getElementById('confetti');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const confettiPieces = [];
      const colors = ['#ff4081', '#ffd740', '#40c4ff', '#69f0ae', '#ffffff'];

      // –°–æ–∑–¥–∞–µ–º 80 —á–∞—Å—Ç–∏—Ü –≤–º–µ—Å—Ç–æ 150 –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
      for (let i = 0; i < 80; i++) {
        confettiPieces.push({
          x: Math.random() * canvas.width,
          y: Math.random() * -canvas.height,
          size: Math.random() * 5 + 3,
          color: colors[Math.floor(Math.random() * colors.length)],
          speed: Math.random() * 3 + 2,
          angle: Math.random() * Math.PI * 2
        });
      }

      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        confettiPieces.forEach(particle => {
          ctx.fillStyle = particle.color;
          ctx.beginPath();
          ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
          ctx.fill();
          
          particle.y += particle.speed;
          particle.x += Math.sin(particle.angle) * 2;
          particle.angle += 0.01;
          
          if (particle.y > canvas.height) {
            particle.y = 0;
            particle.x = Math.random() * canvas.width;
          }
        });
        
        requestAnimationFrame(animate);
      }

      animate();
    }

    // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ —Ä–∞–∑–º–µ—Ä–∞–º —ç–∫—Ä–∞–Ω–∞
    window.addEventListener('resize', () => {
      const canvas = document.getElementById('confetti');
      if (canvas) {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
    });
  </script>
</body>
</html>