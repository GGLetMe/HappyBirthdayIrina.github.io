<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–° –î–Ω—ë–º –†–æ–∂–¥–µ–Ω–∏—è!</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Pacifico&display=swap');
    
    body {
      margin: 0;
      padding: 0;
      font-family: 'Arial Rounded MT Bold', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #ff6ec4, #7873f5);
      overflow: hidden;
      text-align: center;
      color: #fff;
      position: relative;
    }
    
    h1 {
      font-family: 'Pacifico', cursive;
      font-size: 2.8em;
      margin-bottom: 20px;
      text-shadow: 2px 4px 8px rgba(0,0,0,0.3);
      animation: fadeInDown 1s ease;
    }
    
    .cake-container {
      position: relative;
      width: 200px;
      height: 150px;
      margin: 1em auto;
      cursor: pointer;
      animation: fadeInUp 1s ease;
    }
    
    .cake {
      position: absolute;
      bottom: 0;
      width: 180px;
      height: 80px;
      background: #f9c5d1;
      border-radius: 10px 10px 50px 50px;
      box-shadow: inset -15px 0 #f3a6b7;
    }
    
    .cake:before {
      content: '';
      position: absolute;
      top: -10px;
      left: 0;
      width: 180px;
      height: 30px;
      background: #ffdfe8;
      border-radius: 10px 10px 0 0;
    }
    
    .candle {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 12px;
      height: 40px;
      background: linear-gradient(to right, #ffd700, #ffec80, #ffd700);
      border-radius: 3px;
      z-index: 2;
      transition: all 0.3s ease;
    }
    
    .flame {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 15px;
      height: 30px;
      background: linear-gradient(to top, #ff7800, #ffec80);
      border-radius: 50% 50% 20% 20%;
      box-shadow: 0 0 15px #ff7800, 0 0 30px #ffec80;
      animation: flicker 0.8s infinite alternate;
      z-index: 3;
    }
    
    .smoke {
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      width: 5px;
      height: 20px;
      background: #ccc;
      border-radius: 50%;
      opacity: 0;
      z-index: 1;
    }
    
    .instruction {
      margin-top: 1em;
      font-size: 1em;
      color: #fff;
      font-weight: 300;
      animation: pulse 2s infinite;
    }
    
    .message {
      display: none;
      font-size: 1.5em;
      margin-top: 20px;
      animation: fadeIn 2s forwards;
      text-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    
    .mic-button {
      margin-top: 15px;
      padding: 10px 20px;
      background: rgba(255,255,255,0.2);
      border: 2px solid white;
      border-radius: 30px;
      color: white;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .mic-button:hover {
      background: rgba(255,255,255,0.3);
    }
    
    .mic-button:active {
      transform: scale(0.95);
    }
    
    .blow-button {
      margin-top: 15px;
      padding: 10px 20px;
      background: rgba(255,255,255,0.2);
      border: 2px solid white;
      border-radius: 30px;
      color: white;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s;
      display: none;
    }
    
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes flicker {
      0%, 100% { transform: translateX(-50%) scale(1); }
      50% { transform: translateX(-50%) scale(0.9, 1.1); }
    }
    
    @keyframes smoke {
      0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
      100% { transform: translateX(-50%) translateY(-50px) scale(3); opacity: 0; }
    }
    
    @keyframes pulse {
      0% { opacity: 0.6; }
      50% { opacity: 1; }
      100% { opacity: 0.6; }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }
  </style>
</head>
<body>
  <h1>–° –î–Ω—ë–º –†–æ–∂–¥–µ–Ω–∏—è! üéâ</h1>
  
  <div class="cake-container" id="cake">
    <div class="cake"></div>
    <div class="candle">
      <div class="flame" id="flame"></div>
      <div class="smoke" id="smoke"></div>
    </div>
  </div>
  
  <p class="instruction" id="instruction">–ù–∞–∂–º–∏ –Ω–∞ —Ç–æ—Ä—Ç, —á—Ç–æ–±—ã –∑–∞–¥—É—Ç—å —Å–≤–µ—á—É!</p>
  <button class="mic-button" id="micButton">–ó–∞–¥—É—Ç—å —á–µ—Ä–µ–∑ –º–∏–∫—Ä–æ—Ñ–æ–Ω üé§</button>
  <button class="blow-button" id="blowButton">–ó–∞–¥—É—Ç—å –±–µ–∑ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞</button>
  <div class="message" id="message">‚ú® –ü—É—Å—Ç—å —Å–±—É–¥—É—Ç—Å—è –≤—Å–µ –º–µ—á—Ç—ã! ‚ú®</div>

  <canvas id="confetti"></canvas>

  <script>
    // –≠–ª–µ–º–µ–Ω—Ç—ã
    const cake = document.getElementById('cake');
    const flame = document.getElementById('flame');
    const smoke = document.getElementById('smoke');
    const message = document.getElementById('message');
    const instruction = document.getElementById('instruction');
    const micButton = document.getElementById('micButton');
    const blowButton = document.getElementById('blowButton');
    let isCandleLit = true;
    let microphoneAllowed = false;
    let audioContext, analyser, dataArray;

    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–¥—É–≤–∞–Ω–∏—è —Å–≤–µ—á–∏
    function blowOutCandle() {
      if (!isCandleLit) return;
      
      isCandleLit = false;
      flame.style.opacity = '0';
      smoke.style.animation = 'smoke 1.5s ease-out forwards';
      message.style.display = 'block';
      launchConfetti();
      instruction.textContent = '–£—Ä–∞! –¢–µ–ø–µ—Ä—å –∑–∞–≥–∞–¥–∞–π –∂–µ–ª–∞–Ω–∏–µ! ‚ú®';
      micButton.style.display = 'none';
      blowButton.style.display = 'none';
      
      // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∞–ª–∏–∑ –∑–≤—É–∫–∞, –µ—Å–ª–∏ –±—ã–ª –∑–∞–ø—É—â–µ–Ω
      if (analyser) {
        cancelAnimationFrame(animationId);
      }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ —Ç–æ—Ä—Ç—É
    cake.addEventListener('click', () => {
      if (!microphoneAllowed) {
        blowButton.style.display = 'block';
      }
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ó–∞–¥—É—Ç—å –±–µ–∑ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞"
    blowButton.addEventListener('click', blowOutCandle);

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
    micButton.addEventListener('click', async () => {
      try {
        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        microphoneAllowed = true;
        micButton.textContent = '–î—É–π—Ç–µ –≤ –º–∏–∫—Ä–æ—Ñ–æ–Ω...';
        micButton.style.background = 'rgba(0,255,0,0.2)';
        instruction.textContent = '–î—É–π—Ç–µ –≤ –º–∏–∫—Ä–æ—Ñ–æ–Ω, —á—Ç–æ–±—ã –∑–∞–¥—É—Ç—å —Å–≤–µ—á—É!';
        blowButton.style.display = 'none';
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∞–Ω–∞–ª–∏–∑ –∑–≤—É–∫–∞
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const source = audioContext.createMediaStreamSource(stream);
        analyser = audioContext.createAnalyser();
        dataArray = new Uint8Array(analyser.frequencyBinCount);
        source.connect(analyser);
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        checkVolume();
      } catch (error) {
        micButton.textContent = '–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É';
        micButton.style.background = 'rgba(255,0,0,0.2)';
        blowButton.style.display = 'block';
        console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É:', error);
      }
    });

    let animationId;
    function checkVolume() {
      analyser.getByteFrequencyData(dataArray);
      let volume = dataArray.reduce((a,b) => a+b) / dataArray.length;
      
      if (volume > 60 && isCandleLit) {
        blowOutCandle();
      }
      
      if (isCandleLit) {
        animationId = requestAnimationFrame(checkVolume);
      }
    }

    // –ö–æ–Ω—Ñ–µ—Ç—Ç–∏
    function launchConfetti() {
      const canvas = document.getElementById('confetti');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      let confetti = [];

      function randomColor() {
        const colors = ['#ff4081', '#ffd740', '#40c4ff', '#69f0ae', '#ffffff'];
        return colors[Math.floor(Math.random() * colors.length)];
      }

      for (let i = 0; i < 150; i++) {
        confetti.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height - canvas.height,
          r: Math.random() * 6 + 2,
          d: Math.random() * 150,
          color: randomColor(),
          tilt: Math.random() * 10 - 10
        });
      }

      function animateConfetti() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        confetti.forEach((c, i) => {
          ctx.beginPath();
          ctx.fillStyle = c.color;
          ctx.fillRect(c.x, c.y, c.r, c.r);
          ctx.closePath();
          c.y += Math.cos(c.d) + 2 + c.r / 2;
          c.x += Math.sin(c.d);
          if (c.y > canvas.height) {
            confetti[i] = {
              x: Math.random() * canvas.width,
              y: -10,
              r: c.r,
              d: c.d,
              color: c.color,
              tilt: c.tilt
            };
          }
        });
        requestAnimationFrame(animateConfetti);
      }

      animateConfetti();

      window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      });
    }
  </script>
</body>
</html>